<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="claude-codeåŸºç¡€æ¶æ„, æˆ‘çš„åšå®¢">
    <meta name="description" content="å‚è€ƒé“¾æ¥
Dependencies: The Foundation of Claude Codeâ€™s Architectureä¾èµ–ï¼šClaude Codeæ¶æ„çš„åŸºç¡€

*\* Indicates likely custom/embedded">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>claude-codeåŸºç¡€æ¶æ„ | æˆ‘çš„åšå®¢</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">æˆ‘çš„åšå®¢</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>é¦–é¡µ</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>æ ‡ç­¾</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>åˆ†ç±»</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>å½’æ¡£</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="æœç´¢" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="æ·±è‰²/æµ…è‰²æ¨¡å¼" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">æˆ‘çš„åšå®¢</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			é¦–é¡µ
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			æ ‡ç­¾
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			åˆ†ç±»
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			å½’æ¡£
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">claude-codeåŸºç¡€æ¶æ„</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- æ–‡ç« å†…å®¹è¯¦æƒ… -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">æ— æ ‡ç­¾</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp;
                    2025-10-23
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>æ›´æ–°æ—¥æœŸ:&nbsp;&nbsp;
                    2025-10-24
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>æ–‡ç« å­—æ•°:&nbsp;&nbsp;
                    5.2k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>é˜…è¯»æ—¶é•¿:&nbsp;&nbsp;
                    24 åˆ†
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>é˜…è¯»æ¬¡æ•°:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- æ˜¯å¦åŠ è½½ä½¿ç”¨è‡ªå¸¦çš„ prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        
        <!-- ä»£ç å—æŠ˜è¡Œ -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p><a target="_blank" rel="noopener" href="https://southbridge-research.notion.site/Dependencies-The-Foundation-of-Claude-Code-s-Architecture-2055fec70db181b3bb72cdfe615fad3c">å‚è€ƒé“¾æ¥</a></p>
<h1 id="Dependencies-The-Foundation-of-Claude-Codeâ€™s-Architecture"><a href="#Dependencies-The-Foundation-of-Claude-Codeâ€™s-Architecture" class="headerlink" title="Dependencies: The Foundation of Claude Codeâ€™s Architecture"></a>Dependencies: The Foundation of Claude Codeâ€™s Architecture</h1><h2 id="ä¾èµ–ï¼šClaude-Codeæ¶æ„çš„åŸºç¡€"><a href="#ä¾èµ–ï¼šClaude-Codeæ¶æ„çš„åŸºç¡€" class="headerlink" title="ä¾èµ–ï¼šClaude Codeæ¶æ„çš„åŸºç¡€"></a>ä¾èµ–ï¼šClaude Codeæ¶æ„çš„åŸºç¡€</h2><img src="/2025/10/23/claude-code-ji-chu-jia-gou/1.webp" class="">

<p><code>*\*</code> Indicates likely custom/embedded implementation based on decompilation analysis*<br><code>*\*</code> è¡¨ç¤ºåŸºäºåç¼–è¯‘åˆ†æå¯èƒ½çš„è‡ªå®šä¹‰/åµŒå…¥å¼å®ç°*</p>
<h2 id="The-Unconventional-Choices-That-Define-Performance"><a href="#The-Unconventional-Choices-That-Define-Performance" class="headerlink" title="The Unconventional Choices That Define Performance"></a>The Unconventional Choices That Define Performance</h2><h2 id="å®šä¹‰æ€§èƒ½çš„éä¼ ç»Ÿé€‰æ‹©"><a href="#å®šä¹‰æ€§èƒ½çš„éä¼ ç»Ÿé€‰æ‹©" class="headerlink" title="å®šä¹‰æ€§èƒ½çš„éä¼ ç»Ÿé€‰æ‹©"></a>å®šä¹‰æ€§èƒ½çš„éä¼ ç»Ÿé€‰æ‹©</h2><p>Claude Codeâ€™s dependency architecture reveals several fascinating implementation decisions that directly contribute to its renowned performance and reliability. Letâ€™s explore the most technically interesting aspects first.<br>Claude Codeçš„ä¾èµ–æ¶æ„æ­ç¤ºäº†å‡ ä¸ªå¼•äººå…¥èƒœçš„å®ç°å†³ç­–ï¼Œè¿™äº›å†³ç­–ç›´æ¥è´¡çŒ®äº†å…¶è‘—åçš„æ€§èƒ½å’Œå¯é æ€§ã€‚è®©æˆ‘ä»¬å…ˆæ¢ç´¢æŠ€æœ¯ä¸Šæœ€æœ‰è¶£çš„æ–¹é¢ã€‚</p>
<h3 id="ğŸ”-The-React-in-Terminal-Architecture"><a href="#ğŸ”-The-React-in-Terminal-Architecture" class="headerlink" title="ğŸ” The React-in-Terminal Architecture"></a>ğŸ” The React-in-Terminal Architecture</h3><h3 id="ğŸ”-ç»ˆç«¯ä¸­çš„Reactæ¶æ„"><a href="#ğŸ”-ç»ˆç«¯ä¸­çš„Reactæ¶æ„" class="headerlink" title="ğŸ” ç»ˆç«¯ä¸­çš„Reactæ¶æ„"></a>ğŸ” ç»ˆç«¯ä¸­çš„Reactæ¶æ„</h3><pre class="line-numbers language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// The core rendering pipeline appears to implement:</span>
<span class="token comment">// æ ¸å¿ƒæ¸²æŸ“ç®¡é“ä¼¼ä¹å®ç°äº†ï¼š</span>
<span class="token keyword">interface</span> <span class="token class-name">CliRenderPipeline</span> <span class="token punctuation">&#123;</span>
  react<span class="token operator">:</span> <span class="token string">"^18.2.0"</span><span class="token punctuation">,</span>      <span class="token comment">// Full React reconciler å®Œæ•´çš„Reactåè°ƒå™¨</span>
  ink<span class="token operator">:</span> <span class="token string">"^3.2.0"</span><span class="token punctuation">,</span>         <span class="token comment">// Terminal renderer ç»ˆç«¯æ¸²æŸ“å™¨</span>
  yoga<span class="token operator">:</span> <span class="token string">"^2.0.0-beta.1"</span>  <span class="token comment">// Flexbox layout engine (WebAssembly) Flexboxå¸ƒå±€å¼•æ“(WebAssembly)</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Why This Matters</strong>: Unlike traditional CLI tools that manage state imperatively, Claude Code leverages Reactâ€™s reconciliation algorithm for terminal UI. This means:<br><strong>ä¸ºä½•é‡è¦</strong>ï¼šä¸ä¼ ç»Ÿå‘½ä»¤å¼ç®¡ç†çŠ¶æ€çš„CLIå·¥å…·ä¸åŒï¼ŒClaude Codeåˆ©ç”¨Reactçš„åè°ƒç®—æ³•æ¥å¤„ç†ç»ˆç«¯UIã€‚è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li><strong>Virtual DOM in the Terminal</strong>: Every UI update goes through Reactâ€™s diffing algorithm before yoga-layout calculates the optimal terminal character positions</li>
<li><strong>ç»ˆç«¯ä¸­çš„è™šæ‹ŸDOM</strong>ï¼šæ¯æ¬¡UIæ›´æ–°éƒ½è¦ç»è¿‡Reactçš„å·®å¼‚ç®—æ³•ï¼Œç„¶åyoga-layoutè®¡ç®—æœ€ä½³çš„ç»ˆç«¯å­—ç¬¦ä½ç½®</li>
<li><strong>Declarative UI State</strong>: Complex UI states (permission dialogs, progress indicators, concurrent tool execution) are managed declaratively</li>
<li><strong>å£°æ˜å¼UIçŠ¶æ€</strong>ï¼šå¤æ‚çš„UIçŠ¶æ€ï¼ˆæƒé™å¯¹è¯æ¡†ã€è¿›åº¦æŒ‡ç¤ºå™¨ã€å¹¶å‘å·¥å…·æ‰§è¡Œï¼‰éƒ½ä»¥å£°æ˜æ–¹å¼ç®¡ç†</li>
<li><strong>Performance</strong>: The yoga-layout WebAssembly module provides sub-millisecond layout calculations even for complex UIs</li>
<li><strong>æ€§èƒ½</strong>ï¼šyoga-layout WebAssemblyæ¨¡å—ä¸ºå¤æ‚UIæä¾›äºšæ¯«ç§’çº§çš„å¸ƒå±€è®¡ç®—</li>
</ul>
<p>â”Œâ”€ <strong>Implementation Insight</strong> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ The yoga-layout-prebuilt dependency suggests Claude Code        â”‚<br>â”‚ pre-compiles layout constraints, trading memory for speed       â”‚<br>â”‚ during rapid UI updates (e.g., streaming LLM responses)         â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>â”Œâ”€ <strong>å®ç°æ´å¯Ÿ</strong> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ yoga-layout-prebuiltä¾èµ–è¡¨æ˜Claude Code                          â”‚<br>â”‚ é¢„ç¼–è¯‘å¸ƒå±€çº¦æŸï¼Œåœ¨å¿«é€ŸUIæ›´æ–°æœŸé—´ï¼ˆå¦‚æµå¼LLMå“åº”ï¼‰ç”¨å†…å­˜æ¢å–é€Ÿåº¦    â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<h3 id="ğŸ”-The-Streaming-Parser-Architecture"><a href="#ğŸ”-The-Streaming-Parser-Architecture" class="headerlink" title="ğŸ” The Streaming Parser Architecture"></a>ğŸ” The Streaming Parser Architecture</h3><h3 id="ğŸ”-æµå¼è§£æå™¨æ¶æ„"><a href="#ğŸ”-æµå¼è§£æå™¨æ¶æ„" class="headerlink" title="ğŸ” æµå¼è§£æå™¨æ¶æ„"></a>ğŸ” æµå¼è§£æå™¨æ¶æ„</h3><p>Based on decompilation analysis, Claude Code appears to embed custom implementations of critical parsers:<br>åŸºäºåç¼–è¯‘åˆ†æï¼ŒClaude Codeä¼¼ä¹åµŒå…¥äº†å…³é”®è§£æå™¨çš„è‡ªå®šä¹‰å®ç°ï¼š</p>
<pre class="line-numbers language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// Inferred parser capabilities from dependency analysis</span>
<span class="token comment">// ä»ä¾èµ–åˆ†ææ¨æ–­çš„è§£æå™¨åŠŸèƒ½</span>
<span class="token keyword">const</span> <span class="token constant">CUSTOM_PARSERS</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token string-property property">'shell-parse'</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    features<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'JSON object embedding via sentinel strings'</span><span class="token punctuation">,</span> <span class="token comment">// é€šè¿‡å“¨å…µå­—ç¬¦ä¸²åµŒå…¥JSONå¯¹è±¡</span>
      <span class="token string">'Recursive command substitution'</span><span class="token punctuation">,</span> <span class="token comment">// é€’å½’å‘½ä»¤æ›¿æ¢</span>
      <span class="token string">'Environment variable expansion with type preservation'</span> <span class="token comment">// ä¿æŒç±»å‹çš„ç¯å¢ƒå˜é‡å±•å¼€</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    performance<span class="token operator">:</span> <span class="token string">'O(n) with single-pass tokenization'</span> <span class="token comment">// O(n)å•æ¬¡éå†æ ‡è®°åŒ–æ€§èƒ½</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token string-property property">'fast-xml-parser'</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    features<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'Streaming XML parsing for tool calls'</span><span class="token punctuation">,</span> <span class="token comment">// å·¥å…·è°ƒç”¨çš„æµå¼XMLè§£æ</span>
      <span class="token string">'Partial document recovery'</span><span class="token punctuation">,</span> <span class="token comment">// éƒ¨åˆ†æ–‡æ¡£æ¢å¤</span>
      <span class="token string">'Custom entity handling for LLM outputs'</span> <span class="token comment">// LLMè¾“å‡ºçš„è‡ªå®šä¹‰å®ä½“å¤„ç†</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    performance<span class="token operator">:</span> <span class="token string">'Constant memory usage regardless of document size'</span> <span class="token comment">// æ— è®ºæ–‡æ¡£å¤§å°å¦‚ä½•éƒ½ä½¿ç”¨æ’å®šå†…å­˜</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>The Shell Parserâ€™s Secret Weapon</strong>:<br><strong>Shellè§£æå™¨çš„ç§˜å¯†æ­¦å™¨</strong>ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// Conceptual implementation based on analysis</span>
<span class="token comment">// åŸºäºåˆ†æçš„æ¦‚å¿µå®ç°</span>
<span class="token keyword">function</span> <span class="token function">parseShellWithObjects</span><span class="token punctuation">(</span><span class="token parameter">cmd<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token constant">SENTINEL</span> <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomBytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Phase 1: Object serialization</span>
  <span class="token comment">// é˜¶æ®µ1ï¼šå¯¹è±¡åºåˆ—åŒ–</span>
  <span class="token keyword">const</span> processedEnv <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> val<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      acc<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">SENTINEL</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">SENTINEL</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      acc<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> acc<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Phase 2: Standard shell parsing with sentinel preservation</span>
  <span class="token comment">// é˜¶æ®µ2ï¼šä¿ç•™å“¨å…µçš„æ ‡å‡†shellè§£æ</span>
  <span class="token keyword">const</span> tokens <span class="token operator">=</span> <span class="token function">shellParse</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> processedEnv<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Phase 3: Object rehydration</span>
  <span class="token comment">// é˜¶æ®µ3ï¼šå¯¹è±¡é‡æ–°æ°´åŒ–</span>
  <span class="token keyword">return</span> tokens<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">token</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">SENTINEL</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.*</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">SENTINEL</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">$</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token constant">SENTINEL</span><span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token constant">SENTINEL</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> token<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>This allows Claude Code to pass complex configuration objects through shell commandsâ€”a capability not found in standard shell parsers.<br>è¿™ä½¿å¾—Claude Codeèƒ½å¤Ÿé€šè¿‡shellå‘½ä»¤ä¼ é€’å¤æ‚çš„é…ç½®å¯¹è±¡â€”â€”è¿™æ˜¯æ ‡å‡†shellè§£æå™¨ä¸­æ‰¾ä¸åˆ°çš„åŠŸèƒ½ã€‚</p>
<h3 id="ğŸ”-The-Multi-Platform-LLM-Abstraction-Layer"><a href="#ğŸ”-The-Multi-Platform-LLM-Abstraction-Layer" class="headerlink" title="ğŸ” The Multi-Platform LLM Abstraction Layer"></a>ğŸ” The Multi-Platform LLM Abstraction Layer</h3><h3 id="ğŸ”-å¤šå¹³å°LLMæŠ½è±¡å±‚"><a href="#ğŸ”-å¤šå¹³å°LLMæŠ½è±¡å±‚" class="headerlink" title="ğŸ” å¤šå¹³å°LLMæŠ½è±¡å±‚"></a>ğŸ” å¤šå¹³å°LLMæŠ½è±¡å±‚</h3><p>The dependency structure reveals a sophisticated multi-vendor approach:<br>ä¾èµ–ç»“æ„æ­ç¤ºäº†ä¸€ä¸ªå¤æ‚çš„å¤šä¾›åº”å•†æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th>Platform</th>
<th>Primary SDK</th>
<th>Streaming</th>
<th>Specialized Features</th>
</tr>
</thead>
<tbody><tr>
<td>Anthropic</td>
<td>Native SDK</td>
<td>âœ“ Full SSE</td>
<td>Thinking blocks, cache control</td>
</tr>
<tr>
<td>AWS Bedrock</td>
<td>@aws-sdk/client-bedrock-runtime</td>
<td>âœ“ Custom adapter</td>
<td>Cross-region failover, SigV4 auth</td>
</tr>
<tr>
<td>Google Vertex</td>
<td>google-auth-library + custom</td>
<td>âœ“ Via adapter</td>
<td>Automatic token refresh</td>
</tr>
<tr>
<td>å¹³å°</td>
<td>ä¸»è¦SDK</td>
<td>æµå¼ä¼ è¾“</td>
<td>ä¸“ç”¨åŠŸèƒ½</td>
</tr>
<tr>
<td>â€”</td>
<td>â€”</td>
<td>â€”</td>
<td>â€”</td>
</tr>
<tr>
<td>Anthropic</td>
<td>åŸç”ŸSDK</td>
<td>âœ“ å®Œæ•´SSE</td>
<td>æ€ç»´å—ï¼Œç¼“å­˜æ§åˆ¶</td>
</tr>
<tr>
<td>AWS Bedrock</td>
<td>@aws-sdk/client-bedrock-runtime</td>
<td>âœ“ è‡ªå®šä¹‰é€‚é…å™¨</td>
<td>è·¨åŒºåŸŸæ•…éšœè½¬ç§»ï¼ŒSigV4è®¤è¯</td>
</tr>
<tr>
<td>Google Vertex</td>
<td>google-auth-library + è‡ªå®šä¹‰</td>
<td>âœ“ é€šè¿‡é€‚é…å™¨</td>
<td>è‡ªåŠ¨ä»¤ç‰Œåˆ·æ–°</td>
</tr>
</tbody></table>
<p><strong>Implementation Pattern</strong>:<br><strong>å®ç°æ¨¡å¼</strong>ï¼š</p>
<pre class="line-numbers language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// Inferred factory pattern from dependencies</span>
<span class="token comment">// ä»ä¾èµ–é¡¹æ¨æ–­çš„å·¥å‚æ¨¡å¼</span>
<span class="token keyword">class</span> <span class="token class-name">LLMClientFactory</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> <span class="token function">create</span><span class="token punctuation">(</span>provider<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> StreamingLLMClient <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>provider<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">case</span> <span class="token string">'anthropic'</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AnthropicStreamAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'bedrock'</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BedrockStreamAdapter</span><span class="token punctuation">(</span>
          <span class="token keyword">new</span> <span class="token class-name">BedrockRuntimeClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">SigV4Signer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'vertex'</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">VertexStreamAdapter</span><span class="token punctuation">(</span>
          <span class="token keyword">new</span> <span class="token class-name">GoogleAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">CustomHTTPClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ğŸ”-The-Telemetry-Triple-Stack"><a href="#ğŸ”-The-Telemetry-Triple-Stack" class="headerlink" title="ğŸ” The Telemetry Triple-Stack"></a>ğŸ” The Telemetry Triple-Stack</h3><h3 id="ğŸ”-é¥æµ‹ä¸‰é‡æ ˆ"><a href="#ğŸ”-é¥æµ‹ä¸‰é‡æ ˆ" class="headerlink" title="ğŸ” é¥æµ‹ä¸‰é‡æ ˆ"></a>ğŸ” é¥æµ‹ä¸‰é‡æ ˆ</h3><p>Claude Code implements a comprehensive observability strategy using three complementary systems:<br>Claude Codeä½¿ç”¨ä¸‰ä¸ªäº’è¡¥ç³»ç»Ÿå®ç°äº†å…¨é¢çš„å¯è§‚å¯Ÿæ€§ç­–ç•¥ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">â”Œâ”€ Error Tracking â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€ Metrics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€ Feature Flags â”€â”€â”€â”€â”
â”‚ @sentry&#x2F;node             â”‚  â”‚ @opentelemetry&#x2F;api    â”‚  â”‚ statsig-node      â”‚
â”‚ â”œâ”€ ANR detection         â”‚  â”‚ â”œâ”€ Custom spans       â”‚  â”‚ â”œâ”€ A&#x2F;B testing    â”‚
â”‚ â”œâ”€ Error boundaries      â”‚  â”‚ â”œâ”€ Token counters     â”‚  â”‚ â”œâ”€ Gradual rolloutâ”‚
â”‚ â””â”€ Performance profiling â”‚  â”‚ â””â”€ Latency histograms â”‚  â”‚ â””â”€ Dynamic config â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“                              â†“                          â†“
        Debugging                    Optimization              Experimentation
â”Œâ”€ é”™è¯¯è¿½è¸ª â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€ æŒ‡æ ‡ç›‘æ§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€ åŠŸèƒ½æ ‡å¿— â”€â”€â”€â”€â”
â”‚ @sentry&#x2F;node             â”‚  â”‚ @opentelemetry&#x2F;api    â”‚  â”‚ statsig-node      â”‚
â”‚ â”œâ”€ ANRæ£€æµ‹             â”‚  â”‚ â”œâ”€ è‡ªå®šä¹‰span         â”‚  â”‚ â”œâ”€ A&#x2F;Bæµ‹è¯•       â”‚
â”‚ â”œâ”€ é”™è¯¯è¾¹ç•Œ           â”‚  â”‚ â”œâ”€ Tokenè®¡æ•°å™¨        â”‚  â”‚ â”œâ”€ æ¸è¿›å¼å‘å¸ƒ    â”‚
â”‚ â””â”€ æ€§èƒ½åˆ†æ           â”‚  â”‚ â””â”€ å»¶è¿Ÿç›´æ–¹å›¾         â”‚  â”‚ â””â”€ åŠ¨æ€é…ç½®      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“                              â†“                          â†“
         è°ƒè¯•                           ä¼˜åŒ–                    å®éªŒ
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>The ANR Detection Innovation</strong> (inferred from Sentry integration patterns):<br><strong>ANRæ£€æµ‹åˆ›æ–°</strong>ï¼ˆä»Sentryé›†æˆæ¨¡å¼æ¨æ–­ï¼‰ï¼š</p>
<pre class="line-numbers language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// Application Not Responding detection for Node.js</span>
<span class="token comment">// Node.jsåº”ç”¨ç¨‹åºæ— å“åº”æ£€æµ‹</span>
<span class="token keyword">class</span> <span class="token class-name">ANRDetector</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> worker<span class="token operator">:</span> Worker<span class="token punctuation">;</span>
  <span class="token keyword">private</span> heartbeatInterval <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token comment">// ms</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// Spawn a worker thread that expects heartbeats</span>
    <span class="token comment">// ç”Ÿæˆä¸€ä¸ªæœŸæœ›å¿ƒè·³çš„workerçº¿ç¨‹</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      let lastPing = Date.now();
      setInterval(() => &#123;
        if (Date.now() - lastPing > 5000) &#123;
          parentPort.postMessage(&#123;
            type: 'anr',
            stack: getMainThreadStack() // Via inspector protocol
            // é€šè¿‡æ£€æŸ¥å™¨åè®®è·å–
          &#125;);
        &#125;
      &#125;, 100);
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> eval<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Main thread sends heartbeats</span>
    <span class="token comment">// ä¸»çº¿ç¨‹å‘é€å¿ƒè·³</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'ping'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>heartbeatInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>This allows Claude Code to detect and report when the main event loop is blockedâ€”critical for identifying performance issues in production.<br>è¿™ä½¿å¾—Claude Codeèƒ½å¤Ÿæ£€æµ‹å’ŒæŠ¥å‘Šä¸»äº‹ä»¶å¾ªç¯è¢«é˜»å¡çš„æƒ…å†µâ€”â€”å¯¹äºè¯†åˆ«ç”Ÿäº§ç¯å¢ƒä¸­çš„æ€§èƒ½é—®é¢˜è‡³å…³é‡è¦ã€‚</p>
<h3 id="ğŸ”-Data-Transformation-Pipeline"><a href="#ğŸ”-Data-Transformation-Pipeline" class="headerlink" title="ğŸ” Data Transformation Pipeline"></a>ğŸ” Data Transformation Pipeline</h3><h3 id="ğŸ”-æ•°æ®è½¬æ¢ç®¡é“"><a href="#ğŸ”-æ•°æ®è½¬æ¢ç®¡é“" class="headerlink" title="ğŸ” æ•°æ®è½¬æ¢ç®¡é“"></a>ğŸ” æ•°æ®è½¬æ¢ç®¡é“</h3><p>The data processing dependencies form a sophisticated pipeline:<br>æ•°æ®å¤„ç†ä¾èµ–é¡¹å½¢æˆäº†ä¸€ä¸ªå¤æ‚çš„ç®¡é“ï¼š</p>
<pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">graph</span> LR
    <span class="token keyword">subgraph</span> Input
        UserText<span class="token text string">[User Text]</span>
        WebContent<span class="token text string">[Web Content]</span>
        Images<span class="token text string">[Images]</span>
        JSON<span class="token text string">[JSON Data]</span>
    <span class="token keyword">end</span>

    <span class="token keyword">subgraph</span> Transform
        UserText <span class="token arrow operator">--></span> Zod<span class="token text string">&#123;Zod Validation&#125;</span>
        WebContent <span class="token arrow operator">--></span> Marked<span class="token text string">[Markdown Parser]</span>
        WebContent <span class="token arrow operator">--></span> Turndown<span class="token text string">[HTMLâ†’MD]</span>
        Images <span class="token arrow operator">--></span> Sharp<span class="token text string">[Image Processor]</span>
        JSON <span class="token arrow operator">--></span> Zod
    <span class="token keyword">end</span>

    <span class="token keyword">subgraph</span> Output
        Zod <span class="token arrow operator">--></span> ValidatedData<span class="token text string">[Type-Safe Data]</span>
        Marked <span class="token arrow operator">--></span> MarkdownAST<span class="token text string">[Markdown AST]</span>
        Turndown <span class="token arrow operator">--></span> MarkdownText<span class="token text string">[Markdown Text]</span>
        Sharp <span class="token arrow operator">--></span> OptimizedImage<span class="token text string">[Resized/Compressed]</span>
    <span class="token keyword">end</span>

    ValidatedData <span class="token arrow operator">--></span> LLM<span class="token text string">[To LLM]</span>
    MarkdownAST <span class="token arrow operator">--></span> LLM
    MarkdownText <span class="token arrow operator">--></span> LLM
    OptimizedImage <span class="token arrow operator">--></span> LLM

    <span class="token keyword">subgraph</span> è¾“å…¥
        UserText<span class="token text string">[ç”¨æˆ·æ–‡æœ¬]</span>
        WebContent<span class="token text string">[ç½‘é¡µå†…å®¹]</span>
        Images<span class="token text string">[å›¾åƒ]</span>
        JSON<span class="token text string">[JSONæ•°æ®]</span>
    <span class="token keyword">end</span>

    <span class="token keyword">subgraph</span> è½¬æ¢
        UserText <span class="token arrow operator">--></span> Zod<span class="token text string">&#123;ZodéªŒè¯&#125;</span>
        WebContent <span class="token arrow operator">--></span> Marked<span class="token text string">[Markdownè§£æå™¨]</span>
        WebContent <span class="token arrow operator">--></span> Turndown<span class="token text string">[HTMLâ†’MD]</span>
        Images <span class="token arrow operator">--></span> Sharp<span class="token text string">[å›¾åƒå¤„ç†å™¨]</span>
        JSON <span class="token arrow operator">--></span> Zod
    <span class="token keyword">end</span>

    <span class="token keyword">subgraph</span> è¾“å‡º
        Zod <span class="token arrow operator">--></span> ValidatedData<span class="token text string">[ç±»å‹å®‰å…¨æ•°æ®]</span>
        Marked <span class="token arrow operator">--></span> MarkdownAST<span class="token text string">[Markdown AST]</span>
        Turndown <span class="token arrow operator">--></span> MarkdownText<span class="token text string">[Markdownæ–‡æœ¬]</span>
        Sharp <span class="token arrow operator">--></span> OptimizedImage<span class="token text string">[è°ƒæ•´å¤§å°/å‹ç¼©]</span>
    <span class="token keyword">end</span>

    ValidatedData <span class="token arrow operator">--></span> LLM<span class="token text string">[åˆ°LLM]</span>
    MarkdownAST <span class="token arrow operator">--></span> LLM
    MarkdownText <span class="token arrow operator">--></span> LLM
    OptimizedImage <span class="token arrow operator">--></span> LLM
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/2025/10/23/claude-code-ji-chu-jia-gou/2.svg" class="">
<p><strong>Sharp Configuration</strong> (inferred from common patterns):<br><strong>Sharpé…ç½®</strong>ï¼ˆä»å¸¸è§æ¨¡å¼æ¨æ–­ï¼‰ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> imageProcessor <span class="token operator">=</span> <span class="token function">sharp</span><span class="token punctuation">(</span>inputBuffer<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">fit</span><span class="token operator">:</span> <span class="token string">'inside'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">withoutEnlargement</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">jpeg</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token number">85</span><span class="token punctuation">,</span>
    <span class="token literal-property property">progressive</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// Better for streaming</span>
    <span class="token comment">// æ›´é€‚åˆæµå¼ä¼ è¾“</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ğŸ”-The-MCP-Transport-Layer"><a href="#ğŸ”-The-MCP-Transport-Layer" class="headerlink" title="ğŸ” The MCP Transport Layer"></a>ğŸ” The MCP Transport Layer</h3><h3 id="ğŸ”-MCPä¼ è¾“å±‚"><a href="#ğŸ”-MCPä¼ è¾“å±‚" class="headerlink" title="ğŸ” MCPä¼ è¾“å±‚"></a>ğŸ” MCPä¼ è¾“å±‚</h3><p>The Multi-Cloud/Process architecture uses a fascinating abstraction:<br>å¤šäº‘/è¿›ç¨‹æ¶æ„ä½¿ç”¨äº†ä¸€ä¸ªå¼•äººå…¥èƒœçš„æŠ½è±¡ï¼š</p>
<pre class="line-numbers language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// Transport abstraction pattern</span>
<span class="token comment">// ä¼ è¾“æŠ½è±¡æ¨¡å¼</span>
<span class="token keyword">interface</span> <span class="token class-name">MCPTransport</span> <span class="token punctuation">&#123;</span>
  stdio<span class="token operator">:</span> <span class="token string">'cross-spawn'</span><span class="token punctuation">,</span>     <span class="token comment">// Local process communication</span>
  <span class="token comment">// æœ¬åœ°è¿›ç¨‹é€šä¿¡</span>
  websocket<span class="token operator">:</span> <span class="token string">'ws'</span><span class="token punctuation">,</span>          <span class="token comment">// Real-time bidirectional</span>
  <span class="token comment">// å®æ—¶åŒå‘é€šä¿¡</span>
  sse<span class="token operator">:</span> <span class="token string">'eventsource'</span>        <span class="token comment">// Server-sent events</span>
  <span class="token comment">// æœåŠ¡å™¨å‘é€äº‹ä»¶</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// Capability negotiation appears to follow:</span>
<span class="token comment">// åŠŸèƒ½åå•†ä¼¼ä¹éµå¾ªï¼š</span>
<span class="token keyword">class</span> <span class="token class-name">MCPClient</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">async</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> capabilities <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>transport<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'initialize'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      capabilities<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        tools<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        resources<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        prompts<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        logging<span class="token operator">:</span> <span class="token punctuation">&#123;</span> level<span class="token operator">:</span> <span class="token string">'info'</span> <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Dynamic feature detection</span>
    <span class="token comment">// åŠ¨æ€åŠŸèƒ½æ£€æµ‹</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>features <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">negotiateFeatures</span><span class="token punctuation">(</span>capabilities<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Dependency-Categories-Deep-Dive"><a href="#Dependency-Categories-Deep-Dive" class="headerlink" title="Dependency Categories Deep Dive"></a>Dependency Categories Deep Dive</h2><h2 id="ä¾èµ–ç±»åˆ«æ·±åº¦å‰–æ"><a href="#ä¾èµ–ç±»åˆ«æ·±åº¦å‰–æ" class="headerlink" title="ä¾èµ–ç±»åˆ«æ·±åº¦å‰–æ"></a>ä¾èµ–ç±»åˆ«æ·±åº¦å‰–æ</h2><h3 id="Core-CLI-Framework-15-packages"><a href="#Core-CLI-Framework-15-packages" class="headerlink" title="Core CLI Framework (15+ packages)"></a>Core CLI Framework (15+ packages)</h3><h3 id="æ ¸å¿ƒCLIæ¡†æ¶ï¼ˆ15-ä¸ªåŒ…ï¼‰"><a href="#æ ¸å¿ƒCLIæ¡†æ¶ï¼ˆ15-ä¸ªåŒ…ï¼‰" class="headerlink" title="æ ¸å¿ƒCLIæ¡†æ¶ï¼ˆ15+ä¸ªåŒ…ï¼‰"></a>æ ¸å¿ƒCLIæ¡†æ¶ï¼ˆ15+ä¸ªåŒ…ï¼‰</h3><p>The CLI framework dependencies reveal a sophisticated approach to terminal UI:<br>CLIæ¡†æ¶ä¾èµ–é¡¹æ­ç¤ºäº†ä¸€ç§å¤æ‚çš„ç»ˆç«¯UIæ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th>Package</th>
<th>Version*</th>
<th>Purpose</th>
<th>Technical Insight</th>
</tr>
</thead>
<tbody><tr>
<td><code>ink</code></td>
<td>^3.2.0</td>
<td>React renderer for CLI</td>
<td>Custom reconciler implementation</td>
</tr>
<tr>
<td><code>react</code></td>
<td>^18.2.0</td>
<td>UI component model</td>
<td>Full concurrent features enabled</td>
</tr>
<tr>
<td><code>yoga-layout-prebuilt</code></td>
<td>^1.10.0</td>
<td>Flexbox layout</td>
<td>WebAssembly for performance</td>
</tr>
<tr>
<td><code>commander</code></td>
<td>^9.0.0</td>
<td>Argument parsing</td>
<td>Extended with custom option types</td>
</tr>
<tr>
<td><code>chalk</code></td>
<td>^4.1.2</td>
<td>Terminal styling</td>
<td>Template literal API utilized</td>
</tr>
<tr>
<td><code>cli-highlight</code></td>
<td>^2.1.11</td>
<td>Syntax highlighting</td>
<td>Custom language definitions added</td>
</tr>
<tr>
<td><code>strip-ansi</code></td>
<td>^6.0.1</td>
<td>ANSI code removal</td>
<td>Used in text measurement</td>
</tr>
<tr>
<td><code>string-width</code></td>
<td>^4.2.3</td>
<td>Unicode width calc</td>
<td>Full emoji support</td>
</tr>
<tr>
<td><code>wrap-ansi</code></td>
<td>^7.0.0</td>
<td>Text wrapping</td>
<td>Preserves ANSI styling</td>
</tr>
<tr>
<td><code>cli-spinners</code></td>
<td>^2.7.0</td>
<td>Loading animations</td>
<td>Custom spinner definitions</td>
</tr>
<tr>
<td>åŒ…</td>
<td>ç‰ˆæœ¬*</td>
<td>ç”¨é€”</td>
<td>æŠ€æœ¯æ´å¯Ÿ</td>
</tr>
<tr>
<td>â€”</td>
<td>â€”</td>
<td>â€”</td>
<td>â€”</td>
</tr>
<tr>
<td><code>ink</code></td>
<td>^3.2.0</td>
<td>CLIçš„Reactæ¸²æŸ“å™¨</td>
<td>è‡ªå®šä¹‰åè°ƒå™¨å®ç°</td>
</tr>
<tr>
<td><code>react</code></td>
<td>^18.2.0</td>
<td>UIç»„ä»¶æ¨¡å‹</td>
<td>å¯ç”¨å®Œæ•´å¹¶å‘åŠŸèƒ½</td>
</tr>
<tr>
<td><code>yoga-layout-prebuilt</code></td>
<td>^1.10.0</td>
<td>Flexboxå¸ƒå±€</td>
<td>WebAssemblyæå‡æ€§èƒ½</td>
</tr>
<tr>
<td><code>commander</code></td>
<td>^9.0.0</td>
<td>å‚æ•°è§£æ</td>
<td>æ‰©å±•è‡ªå®šä¹‰é€‰é¡¹ç±»å‹</td>
</tr>
<tr>
<td><code>chalk</code></td>
<td>^4.1.2</td>
<td>ç»ˆç«¯æ ·å¼</td>
<td>ä½¿ç”¨æ¨¡æ¿å­—é¢é‡API</td>
</tr>
<tr>
<td><code>cli-highlight</code></td>
<td>^2.1.11</td>
<td>è¯­æ³•é«˜äº®</td>
<td>æ·»åŠ è‡ªå®šä¹‰è¯­è¨€å®šä¹‰</td>
</tr>
<tr>
<td><code>strip-ansi</code></td>
<td>^6.0.1</td>
<td>ANSIä»£ç ç§»é™¤</td>
<td>ç”¨äºæ–‡æœ¬æµ‹é‡</td>
</tr>
<tr>
<td><code>string-width</code></td>
<td>^4.2.3</td>
<td>Unicodeå®½åº¦è®¡ç®—</td>
<td>å®Œæ•´emojiæ”¯æŒ</td>
</tr>
<tr>
<td><code>wrap-ansi</code></td>
<td>^7.0.0</td>
<td>æ–‡æœ¬æ¢è¡Œ</td>
<td>ä¿æŒANSIæ ·å¼</td>
</tr>
<tr>
<td><code>cli-spinners</code></td>
<td>^2.7.0</td>
<td>åŠ è½½åŠ¨ç”»</td>
<td>è‡ªå®šä¹‰spinnerå®šä¹‰</td>
</tr>
</tbody></table>
<p><em>Versions inferred from ecosystem compatibility analysis</em><br><em>ç‰ˆæœ¬ä»ç”Ÿæ€ç³»ç»Ÿå…¼å®¹æ€§åˆ†ææ¨æ–­</em></p>
<p><strong>Performance Optimization Pattern</strong>:<br><strong>æ€§èƒ½ä¼˜åŒ–æ¨¡å¼</strong>ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// String width calculation with caching</span>
<span class="token comment">// å¸¦ç¼“å­˜çš„å­—ç¬¦ä¸²å®½åº¦è®¡ç®—</span>
<span class="token keyword">const</span> widthCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getCachedWidth</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>widthCache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    widthCache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token function">stringWidth</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> widthCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="LLM-Integration-Stack-5-packages"><a href="#LLM-Integration-Stack-5-packages" class="headerlink" title="LLM Integration Stack (5+ packages)"></a>LLM Integration Stack (5+ packages)</h3><h3 id="LLMé›†æˆå †æ ˆï¼ˆ5-ä¸ªåŒ…ï¼‰"><a href="#LLMé›†æˆå †æ ˆï¼ˆ5-ä¸ªåŒ…ï¼‰" class="headerlink" title="LLMé›†æˆå †æ ˆï¼ˆ5+ä¸ªåŒ…ï¼‰"></a>LLMé›†æˆå †æ ˆï¼ˆ5+ä¸ªåŒ…ï¼‰</h3><p>The LLM integration reveals a multi-provider strategy with sophisticated fallback:<br>LLMé›†æˆæ­ç¤ºäº†ä¸€ä¸ªå…·æœ‰å¤æ‚æ•…éšœè½¬ç§»çš„å¤šä¾›åº”å•†ç­–ç•¥ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">â”Œâ”€ Provider Selection Logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Check API key availability                          â”‚
â”‚ 2. Evaluate rate limits across providers               â”‚
â”‚ 3. Consider feature requirements (streaming, tools)    â”‚
â”‚ 4. Apply cost optimization rules                       â”‚
â”‚ 5. Fallback chain: Anthropic â†’ Bedrock â†’ Vertex        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€ ä¾›åº”å•†é€‰æ‹©é€»è¾‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ£€æŸ¥APIå¯†é’¥å¯ç”¨æ€§                            â”‚
â”‚ 2. è¯„ä¼°è·¨ä¾›åº”å•†é€Ÿç‡é™åˆ¶                           â”‚
â”‚ 3. è€ƒè™‘åŠŸèƒ½è¦æ±‚ï¼ˆæµå¼ä¼ è¾“ï¼Œå·¥å…·ï¼‰                   â”‚
â”‚ 4. åº”ç”¨æˆæœ¬ä¼˜åŒ–è§„åˆ™                              â”‚
â”‚ 5. æ•…éšœè½¬ç§»é“¾ï¼šAnthropic â†’ Bedrock â†’ Vertex     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>AWS SDK Components</strong> (inferred from @aws-sdk/* patterns):<br><strong>AWS SDKç»„ä»¶</strong>ï¼ˆä»@aws-sdk/*æ¨¡å¼æ¨æ–­ï¼‰ï¼š</p>
<ul>
<li><code>@aws-sdk/client-bedrock-runtime</code>: Primary Bedrock client</li>
<li><code>@aws-sdk/signature-v4</code>: Request signing</li>
<li><code>@aws-sdk/middleware-retry</code>: Intelligent retry logic</li>
<li><code>@aws-sdk/smithy-client</code>: Protocol implementation</li>
<li><code>@aws-sdk/types</code>: Shared type definitions</li>
<li><code>@aws-sdk/client-bedrock-runtime</code>: ä¸»è¦Bedrockå®¢æˆ·ç«¯</li>
<li><code>@aws-sdk/signature-v4</code>: è¯·æ±‚ç­¾å</li>
<li><code>@aws-sdk/middleware-retry</code>: æ™ºèƒ½é‡è¯•é€»è¾‘</li>
<li><code>@aws-sdk/smithy-client</code>: åè®®å®ç°</li>
<li><code>@aws-sdk/types</code>: å…±äº«ç±»å‹å®šä¹‰</li>
</ul>
<h3 id="Data-Processing-amp-Validation-8-packages"><a href="#Data-Processing-amp-Validation-8-packages" class="headerlink" title="Data Processing &amp; Validation (8+ packages)"></a>Data Processing &amp; Validation (8+ packages)</h3><h3 id="æ•°æ®å¤„ç†ä¸éªŒè¯ï¼ˆ8-ä¸ªåŒ…ï¼‰"><a href="#æ•°æ®å¤„ç†ä¸éªŒè¯ï¼ˆ8-ä¸ªåŒ…ï¼‰" class="headerlink" title="æ•°æ®å¤„ç†ä¸éªŒè¯ï¼ˆ8+ä¸ªåŒ…ï¼‰"></a>æ•°æ®å¤„ç†ä¸éªŒè¯ï¼ˆ8+ä¸ªåŒ…ï¼‰</h3><pre class="line-numbers language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// Zod schema compilation pattern (inferred)</span>
<span class="token comment">// Zodæ¨¡å¼ç¼–è¯‘æ¨¡å¼ï¼ˆæ¨æ–­ï¼‰</span>
<span class="token keyword">const</span> <span class="token constant">COMPILED_SCHEMAS</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getCompiledSchema</span><span class="token punctuation">(</span>schema<span class="token operator">:</span> ZodSchema<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> key <span class="token operator">=</span> schema<span class="token punctuation">.</span>_def<span class="token punctuation">.</span>shape<span class="token punctuation">;</span> <span class="token comment">// Simplified</span>
  <span class="token comment">// ç®€åŒ–ç‰ˆ</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">COMPILED_SCHEMAS</span><span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token constant">COMPILED_SCHEMAS</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      validator<span class="token operator">:</span> schema<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span><span class="token punctuation">,</span>
      jsonSchema<span class="token operator">:</span> <span class="token function">zodToJsonSchema</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span><span class="token punctuation">,</span>
      tsType<span class="token operator">:</span> <span class="token function">zodToTs</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token constant">COMPILED_SCHEMAS</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Transformation Pipeline Performance</strong>:<br><strong>è½¬æ¢ç®¡é“æ€§èƒ½</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Library</th>
<th>Performance</th>
<th>Memory</th>
</tr>
</thead>
<tbody><tr>
<td>Markdownâ†’AST</td>
<td>marked</td>
<td>O(n)</td>
<td>Streaming capable</td>
</tr>
<tr>
<td>HTMLâ†’Markdown</td>
<td>turndown</td>
<td>O(n)</td>
<td>DOM size limited</td>
</tr>
<tr>
<td>Image resize</td>
<td>sharp</td>
<td>O(1)*</td>
<td>Native memory</td>
</tr>
<tr>
<td>JSON validation</td>
<td>zod</td>
<td>O(n)</td>
<td>Fail-fast</td>
</tr>
<tr>
<td>Text diff</td>
<td>diff</td>
<td>O(nÂ²)</td>
<td>Myers algorithm</td>
</tr>
<tr>
<td>æ“ä½œ</td>
<td>åº“</td>
<td>æ€§èƒ½</td>
<td>å†…å­˜</td>
</tr>
<tr>
<td>â€”</td>
<td>â€”</td>
<td>â€”</td>
<td>â€”</td>
</tr>
<tr>
<td>Markdownâ†’AST</td>
<td>marked</td>
<td>O(n)</td>
<td>æ”¯æŒæµå¼å¤„ç†</td>
</tr>
<tr>
<td>HTMLâ†’Markdown</td>
<td>turndown</td>
<td>O(n)</td>
<td>DOMå¤§å°é™åˆ¶</td>
</tr>
<tr>
<td>å›¾åƒè°ƒæ•´å¤§å°</td>
<td>sharp</td>
<td>O(1)*</td>
<td>åŸç”Ÿå†…å­˜</td>
</tr>
<tr>
<td>JSONéªŒè¯</td>
<td>zod</td>
<td>O(n)</td>
<td>å¿«é€Ÿå¤±è´¥</td>
</tr>
<tr>
<td>æ–‡æœ¬å·®å¼‚</td>
<td>diff</td>
<td>O(nÂ²)</td>
<td>Myersç®—æ³•</td>
</tr>
</tbody></table>
<ul>
<li>With hardware acceleration</li>
<li>å¸¦ç¡¬ä»¶åŠ é€Ÿ</li>
</ul>
<h3 id="File-System-Intelligence-6-packages"><a href="#File-System-Intelligence-6-packages" class="headerlink" title="File System Intelligence (6+ packages)"></a>File System Intelligence (6+ packages)</h3><h3 id="æ–‡ä»¶ç³»ç»Ÿæ™ºèƒ½ï¼ˆ6-ä¸ªåŒ…ï¼‰"><a href="#æ–‡ä»¶ç³»ç»Ÿæ™ºèƒ½ï¼ˆ6-ä¸ªåŒ…ï¼‰" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿæ™ºèƒ½ï¼ˆ6+ä¸ªåŒ…ï¼‰"></a>æ–‡ä»¶ç³»ç»Ÿæ™ºèƒ½ï¼ˆ6+ä¸ªåŒ…ï¼‰</h3><p>The file system dependencies implement a sophisticated filtering pipeline:<br>æ–‡ä»¶ç³»ç»Ÿä¾èµ–é¡¹å®ç°äº†ä¸€ä¸ªå¤æ‚çš„è¿‡æ»¤ç®¡é“ï¼š</p>
<pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">graph</span> TD
    UserPattern<span class="token text string">[User Pattern]</span> <span class="token arrow operator">--></span> GlobParser<span class="token text string">&#123;glob&#125;</span>
    GlobParser <span class="token arrow operator">--></span> Picomatch<span class="token text string">&#123;picomatch&#125;</span>
    GlobParser <span class="token arrow operator">--></span> Minimatch<span class="token text string">&#123;minimatch&#125;</span>

    Picomatch <span class="token arrow operator">--></span> FileList<span class="token text string">[File List]</span>
    Minimatch <span class="token arrow operator">--></span> FileList

    FileList <span class="token arrow operator">--></span> IgnoreFilter<span class="token text string">&#123;ignore&#125;</span>
    IgnoreFilter <span class="token arrow operator">--></span> GitignoreRules<span class="token text string">[.gitignore Rules]</span>
    IgnoreFilter <span class="token arrow operator">--></span> CustomRules<span class="token text string">[Custom Rules]</span>

    IgnoreFilter <span class="token arrow operator">--></span> FinalList<span class="token text string">[Filtered Results]</span>

    UserPattern<span class="token text string">[ç”¨æˆ·æ¨¡å¼]</span> <span class="token arrow operator">--></span> GlobParser<span class="token text string">&#123;glob&#125;</span>
    GlobParser <span class="token arrow operator">--></span> Picomatch<span class="token text string">&#123;picomatch&#125;</span>
    GlobParser <span class="token arrow operator">--></span> Minimatch<span class="token text string">&#123;minimatch&#125;</span>

    Picomatch <span class="token arrow operator">--></span> FileList<span class="token text string">[æ–‡ä»¶åˆ—è¡¨]</span>
    Minimatch <span class="token arrow operator">--></span> FileList

    FileList <span class="token arrow operator">--></span> IgnoreFilter<span class="token text string">&#123;ignore&#125;</span>
    IgnoreFilter <span class="token arrow operator">--></span> GitignoreRules<span class="token text string">[.gitignoreè§„åˆ™]</span>
    IgnoreFilter <span class="token arrow operator">--></span> CustomRules<span class="token text string">[è‡ªå®šä¹‰è§„åˆ™]</span>

    IgnoreFilter <span class="token arrow operator">--></span> FinalList<span class="token text string">[è¿‡æ»¤ç»“æœ]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/2025/10/23/claude-code-ji-chu-jia-gou/3.svg" class="">
<p><strong>Pattern Matching Optimization</strong>:<br><strong>æ¨¡å¼åŒ¹é…ä¼˜åŒ–</strong>ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// Compiled pattern caching (inferred)</span>
<span class="token comment">// ç¼–è¯‘æ¨¡å¼ç¼“å­˜ï¼ˆæ¨æ–­ï¼‰</span>
<span class="token keyword">class</span> <span class="token class-name">PatternMatcher</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> compiledPatterns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LRUCache</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">match</span><span class="token punctuation">(</span><span class="token parameter">pattern<span class="token punctuation">,</span> path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> compiled <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>compiledPatterns<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>compiled<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      compiled <span class="token operator">=</span> <span class="token function">picomatch</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">bash</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">dot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">nobrace</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>compiledPatterns<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> compiled<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token function">compiled</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Telemetry-amp-Observability-4-packages"><a href="#Telemetry-amp-Observability-4-packages" class="headerlink" title="Telemetry &amp; Observability (4+ packages)"></a>Telemetry &amp; Observability (4+ packages)</h3><h3 id="é¥æµ‹ä¸å¯è§‚å¯Ÿæ€§ï¼ˆ4-ä¸ªåŒ…ï¼‰"><a href="#é¥æµ‹ä¸å¯è§‚å¯Ÿæ€§ï¼ˆ4-ä¸ªåŒ…ï¼‰" class="headerlink" title="é¥æµ‹ä¸å¯è§‚å¯Ÿæ€§ï¼ˆ4+ä¸ªåŒ…ï¼‰"></a>é¥æµ‹ä¸å¯è§‚å¯Ÿæ€§ï¼ˆ4+ä¸ªåŒ…ï¼‰</h3><p>The telemetry stack implements defense-in-depth monitoring:<br>é¥æµ‹å †æ ˆå®ç°äº†æ·±åº¦é˜²å¾¡ç›‘æ§ï¼š</p>
<p><strong>Sentry Integration Layers</strong>:<br><strong>Sentryé›†æˆå±‚</strong>ï¼š</p>
<ol>
<li><strong>Error Boundary</strong>: React error boundaries for UI crashes</li>
<li><strong>Global Handler</strong>: Process-level uncaught exceptions</li>
<li><strong>Promise Rejection</strong>: Unhandled promise tracking</li>
<li><strong>ANR Detection</strong>: Custom worker-thread monitoring</li>
<li><strong>Performance</strong>: Transaction and span tracking</li>
<li><strong>é”™è¯¯è¾¹ç•Œ</strong>: ç”¨äºUIå´©æºƒçš„Reacté”™è¯¯è¾¹ç•Œ</li>
<li><strong>å…¨å±€å¤„ç†å™¨</strong>: è¿›ç¨‹çº§æœªæ•è·å¼‚å¸¸</li>
<li><strong>Promiseæ‹’ç»</strong>: æœªå¤„ç†çš„Promiseè·Ÿè¸ª</li>
<li><strong>ANRæ£€æµ‹</strong>: è‡ªå®šä¹‰å·¥ä½œçº¿ç¨‹ç›‘æ§</li>
<li><strong>æ€§èƒ½</strong>: äº‹åŠ¡å’Œspanè·Ÿè¸ª</li>
</ol>
<p><strong>OpenTelemetry Instrumentation</strong>:<br><strong>OpenTelemetryä»ªè¡¨åŒ–</strong>ï¼š</p>
<pre class="line-numbers language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// Custom span creation for tool execution</span>
<span class="token comment">// å·¥å…·æ‰§è¡Œçš„è‡ªå®šä¹‰spanåˆ›å»º</span>
<span class="token keyword">function</span> <span class="token function">instrumentToolExecution</span><span class="token punctuation">(</span>tool<span class="token operator">:</span> Tool<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> span <span class="token operator">=</span> tracer<span class="token punctuation">.</span><span class="token function">startSpan</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">tool.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>tool<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      attributes<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string-property property">'tool.name'</span><span class="token operator">:</span> tool<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
        <span class="token string-property property">'tool.readonly'</span><span class="token operator">:</span> tool<span class="token punctuation">.</span>isReadOnly<span class="token punctuation">,</span>
        <span class="token string-property property">'tool.input.size'</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">tool</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
      span<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Statsig Feature Flag Patterns</strong>:<br><strong>StatsigåŠŸèƒ½æ ‡å¿—æ¨¡å¼</strong>ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// Gradual rollout configuration (inferred)</span>
<span class="token comment">// æ¸è¿›å¼å‘å¸ƒé…ç½®ï¼ˆæ¨æ–­ï¼‰</span>
<span class="token keyword">const</span> <span class="token constant">FEATURE_FLAGS</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token string-property property">'unified_read_tool'</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">rollout</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token literal-property property">overrides</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">internal</span><span class="token operator">:</span> <span class="token number">1.0</span> <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token string-property property">'parallel_tool_execution'</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">rollout</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">conditions</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'user_tier'</span><span class="token punctuation">,</span> <span class="token literal-property property">operator</span><span class="token operator">:</span> <span class="token string">'in'</span><span class="token punctuation">,</span> <span class="token literal-property property">values</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'pro'</span><span class="token punctuation">,</span> <span class="token string">'enterprise'</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token string-property property">'sandbox_bash_default'</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">rollout</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sticky</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// Consistent per user</span>
    <span class="token comment">// æ¯ä¸ªç”¨æˆ·ä¿æŒä¸€è‡´</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Hidden-Gems-The-Specialized-Dependencies"><a href="#Hidden-Gems-The-Specialized-Dependencies" class="headerlink" title="Hidden Gems: The Specialized Dependencies"></a>Hidden Gems: The Specialized Dependencies</h2><h2 id="éšè—çš„å®çŸ³ï¼šä¸“ä¸šåŒ–ä¾èµ–é¡¹"><a href="#éšè—çš„å®çŸ³ï¼šä¸“ä¸šåŒ–ä¾èµ–é¡¹" class="headerlink" title="éšè—çš„å®çŸ³ï¼šä¸“ä¸šåŒ–ä¾èµ–é¡¹"></a>éšè—çš„å®çŸ³ï¼šä¸“ä¸šåŒ–ä¾èµ–é¡¹</h2><h3 id="XML-Parsing-for-LLM-Communication"><a href="#XML-Parsing-for-LLM-Communication" class="headerlink" title="XML Parsing for LLM Communication"></a>XML Parsing for LLM Communication</h3><h3 id="ç”¨äºLLMé€šä¿¡çš„XMLè§£æ"><a href="#ç”¨äºLLMé€šä¿¡çš„XMLè§£æ" class="headerlink" title="ç”¨äºLLMé€šä¿¡çš„XMLè§£æ"></a>ç”¨äºLLMé€šä¿¡çš„XMLè§£æ</h3><p>The embedded <code>fast-xml-parser</code> appears to be customized for LLM response parsing:<br>åµŒå…¥çš„<code>fast-xml-parser</code>ä¼¼ä¹æ˜¯ä¸ºLLMå“åº”è§£æè€Œå®šåˆ¶çš„ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// Inferred XML parser configuration</span>
<span class="token comment">// æ¨æ–­çš„XMLè§£æå™¨é…ç½®</span>
<span class="token keyword">const</span> llmXmlParser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLParser</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">ignoreAttributes</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parseTagValue</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// Keep as strings</span>
  <span class="token comment">// ä¿æŒä¸ºå­—ç¬¦ä¸²</span>
  <span class="token literal-property property">trimValues</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parseTrueNumberOnly</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

  <span class="token comment">// Custom tag processors</span>
  <span class="token comment">// è‡ªå®šä¹‰æ ‡ç­¾å¤„ç†å™¨</span>
  <span class="token function-variable function">tagValueProcessor</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">tagName<span class="token punctuation">,</span> tagValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tagName <span class="token operator">===</span> <span class="token string">'tool_input'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// Parse JSON content within XML</span>
      <span class="token comment">// è§£æXMLä¸­çš„JSONå†…å®¹</span>
      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>tagValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">'Invalid JSON in tool_input'</span><span class="token punctuation">,</span> <span class="token literal-property property">raw</span><span class="token operator">:</span> tagValue <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> tagValue<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="The-plist-Parser-Mystery"><a href="#The-plist-Parser-Mystery" class="headerlink" title="The plist Parser Mystery"></a>The plist Parser Mystery</h3><h3 id="plistè§£æå™¨ä¹‹è°œ"><a href="#plistè§£æå™¨ä¹‹è°œ" class="headerlink" title="plistè§£æå™¨ä¹‹è°œ"></a>plistè§£æå™¨ä¹‹è°œ</h3><p>The inclusion of <code>plist</code> (Apple Property List parser) suggests macOS-specific optimizations:<br><code>plist</code>ï¼ˆAppleå±æ€§åˆ—è¡¨è§£æå™¨ï¼‰çš„åŒ…å«æš—ç¤ºäº†macOSç‰¹å®šçš„ä¼˜åŒ–ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// Possible use cases (inferred)</span>
<span class="token comment">// å¯èƒ½çš„ç”¨ä¾‹ï¼ˆæ¨æ–­ï¼‰</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadMacOSConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token keyword">await</span> plist<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>
    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'~/Library/Preferences/com.anthropic.claude-code.plist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">apiKeys</span><span class="token operator">:</span> config<span class="token punctuation">.</span>APIKeys<span class="token punctuation">,</span> <span class="token comment">// Stored in Keychain reference</span>
    <span class="token comment">// å­˜å‚¨åœ¨é’¥åŒ™ä¸²å¼•ç”¨ä¸­</span>
    <span class="token literal-property property">sandboxProfiles</span><span class="token operator">:</span> config<span class="token punctuation">.</span>SandboxProfiles<span class="token punctuation">,</span>
    <span class="token literal-property property">ideIntegrations</span><span class="token operator">:</span> config<span class="token punctuation">.</span>IDEIntegrations
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Cross-Platform-Process-Spawning"><a href="#Cross-Platform-Process-Spawning" class="headerlink" title="Cross-Platform Process Spawning"></a>Cross-Platform Process Spawning</h3><h3 id="è·¨å¹³å°è¿›ç¨‹ç”Ÿæˆ"><a href="#è·¨å¹³å°è¿›ç¨‹ç”Ÿæˆ" class="headerlink" title="è·¨å¹³å°è¿›ç¨‹ç”Ÿæˆ"></a>è·¨å¹³å°è¿›ç¨‹ç”Ÿæˆ</h3><p>The <code>cross-spawn</code> dependency handles platform differences:<br><code>cross-spawn</code>ä¾èµ–é¡¹å¤„ç†å¹³å°å·®å¼‚ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// MCP server launching pattern</span>
<span class="token comment">// MCPæœåŠ¡å™¨å¯åŠ¨æ¨¡å¼</span>
<span class="token keyword">function</span> <span class="token function">launchMCPServer</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> spawn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cross-spawn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>command<span class="token punctuation">,</span> config<span class="token punctuation">.</span>args<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'pipe'</span><span class="token punctuation">,</span> <span class="token string">'pipe'</span><span class="token punctuation">,</span> <span class="token string">'pipe'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token operator">...</span>process<span class="token punctuation">.</span>env<span class="token punctuation">,</span>
      <span class="token constant">MCP_VERSION</span><span class="token operator">:</span> <span class="token string">'1.0'</span><span class="token punctuation">,</span>
      <span class="token comment">// Windows: Handles .cmd/.bat properly</span>
      <span class="token comment">// Windowsï¼šæ­£ç¡®å¤„ç†.cmd/.bat</span>
      <span class="token comment">// Unix: Preserves shebangs</span>
      <span class="token comment">// Unixï¼šä¿ç•™shebang</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">shell</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// Security: avoid shell injection</span>
    <span class="token comment">// å®‰å…¨ï¼šé¿å…shellæ³¨å…¥</span>
    <span class="token literal-property property">windowsHide</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// No console window on Windows</span>
    <span class="token comment">// Windowsä¸Šä¸æ˜¾ç¤ºæ§åˆ¶å°çª—å£</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MCPStdioTransport</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Dependency-Security-Considerations"><a href="#Dependency-Security-Considerations" class="headerlink" title="Dependency Security Considerations"></a>Dependency Security Considerations</h2><h2 id="ä¾èµ–é¡¹å®‰å…¨è€ƒè™‘"><a href="#ä¾èµ–é¡¹å®‰å…¨è€ƒè™‘" class="headerlink" title="ä¾èµ–é¡¹å®‰å…¨è€ƒè™‘"></a>ä¾èµ–é¡¹å®‰å…¨è€ƒè™‘</h2><p>Based on the dependency analysis, several security patterns emerge:<br>åŸºäºä¾èµ–é¡¹åˆ†æï¼Œå‡ºç°äº†å‡ ç§å®‰å…¨æ¨¡å¼ï¼š</p>
<p><strong>1. Input Validation Layer</strong>:<br><strong>1. è¾“å…¥éªŒè¯å±‚</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">User Input â†’ Zod Schema â†’ Validated Data â†’ Tool Execution
     â†“
  Rejected
ç”¨æˆ·è¾“å…¥ â†’ Zodæ¨¡å¼ â†’ éªŒè¯æ•°æ® â†’ å·¥å…·æ‰§è¡Œ
     â†“
   æ‹’ç»
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2. Sandboxing Dependencies</strong>:<br><strong>2. æ²™ç›’åŒ–ä¾èµ–é¡¹</strong>ï¼š</p>
<ul>
<li>No <code>child_process</code> direct usage (uses <code>cross-spawn</code>)</li>
<li>No <code>eval</code> usage (except controlled worker threads)</li>
<li>No dynamic <code>require</code> patterns detected</li>
<li>æ²¡æœ‰ç›´æ¥ä½¿ç”¨<code>child_process</code>ï¼ˆä½¿ç”¨<code>cross-spawn</code>ï¼‰</li>
<li>æ²¡æœ‰ä½¿ç”¨<code>eval</code>ï¼ˆé™¤äº†å—æ§çš„å·¥ä½œçº¿ç¨‹ï¼‰</li>
<li>æ²¡æœ‰æ£€æµ‹åˆ°åŠ¨æ€<code>require</code>æ¨¡å¼</li>
</ul>
<p><strong>3. Secret Management</strong>:<br><strong>3. ç§˜å¯†ç®¡ç†</strong>ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// Inferred pattern from absence of secret-storage deps</span>
<span class="token comment">// ä»ç¼ºå°‘ç§˜å¯†å­˜å‚¨ä¾èµ–é¡¹æ¨æ–­çš„æ¨¡å¼</span>
<span class="token keyword">class</span> <span class="token class-name">SecretManager</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">async</span> <span class="token function">getAPIKey</span><span class="token punctuation">(</span><span class="token parameter">provider</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>platform <span class="token operator">===</span> <span class="token string">'darwin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// Use native Keychain via N-API</span>
      <span class="token comment">// é€šè¿‡N-APIä½¿ç”¨åŸç”Ÿé’¥åŒ™ä¸²</span>
      <span class="token keyword">return</span> <span class="token keyword">await</span> keychain<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token string">'claude-code'</span><span class="token punctuation">,</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// Fallback to environment variables</span>
      <span class="token comment">// å›é€€åˆ°ç¯å¢ƒå˜é‡</span>
      <span class="token keyword">return</span> process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>provider<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">_API_KEY</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Performance-Implications-of-Dependency-Choices"><a href="#Performance-Implications-of-Dependency-Choices" class="headerlink" title="Performance Implications of Dependency Choices"></a>Performance Implications of Dependency Choices</h2><h2 id="ä¾èµ–é¡¹é€‰æ‹©çš„æ€§èƒ½å½±å“"><a href="#ä¾èµ–é¡¹é€‰æ‹©çš„æ€§èƒ½å½±å“" class="headerlink" title="ä¾èµ–é¡¹é€‰æ‹©çš„æ€§èƒ½å½±å“"></a>ä¾èµ–é¡¹é€‰æ‹©çš„æ€§èƒ½å½±å“</h2><h3 id="Memory-Management-Strategy"><a href="#Memory-Management-Strategy" class="headerlink" title="Memory Management Strategy"></a>Memory Management Strategy</h3><h3 id="å†…å­˜ç®¡ç†ç­–ç•¥"><a href="#å†…å­˜ç®¡ç†ç­–ç•¥" class="headerlink" title="å†…å­˜ç®¡ç†ç­–ç•¥"></a>å†…å­˜ç®¡ç†ç­–ç•¥</h3><p>The dependency selection reveals a careful memory management approach:<br>ä¾èµ–é¡¹é€‰æ‹©æ­ç¤ºäº†ä»”ç»†çš„å†…å­˜ç®¡ç†æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Strategy</th>
<th>Implementation</th>
</tr>
</thead>
<tbody><tr>
<td>File Reading</td>
<td>Streaming</td>
<td><code>glob.stream</code>, chunked reads</td>
</tr>
<tr>
<td>Image Processing</td>
<td>Native</td>
<td><code>sharp</code> with libvips (off-heap)</td>
</tr>
<tr>
<td>XML Parsing</td>
<td>SAX-style</td>
<td>Event-based, constant memory</td>
</tr>
<tr>
<td>Pattern Matching</td>
<td>Compiled</td>
<td>Pre-compiled regex patterns</td>
</tr>
<tr>
<td>UI Rendering</td>
<td>Virtual DOM</td>
<td>Minimal terminal updates</td>
</tr>
<tr>
<td>ç»„ä»¶</td>
<td>ç­–ç•¥</td>
<td>å®ç°</td>
</tr>
<tr>
<td>â€”</td>
<td>â€”</td>
<td>â€”</td>
</tr>
<tr>
<td>æ–‡ä»¶è¯»å–</td>
<td>æµå¼</td>
<td><code>glob.stream</code>ï¼Œåˆ†å—è¯»å–</td>
</tr>
<tr>
<td>å›¾åƒå¤„ç†</td>
<td>åŸç”Ÿ</td>
<td><code>sharp</code>ä¸libvipsï¼ˆå †å¤–ï¼‰</td>
</tr>
<tr>
<td>XMLè§£æ</td>
<td>SAXé£æ ¼</td>
<td>åŸºäºäº‹ä»¶ï¼Œå¸¸é‡å†…å­˜</td>
</tr>
<tr>
<td>æ¨¡å¼åŒ¹é…</td>
<td>ç¼–è¯‘</td>
<td>é¢„ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼</td>
</tr>
<tr>
<td>UIæ¸²æŸ“</td>
<td>è™šæ‹ŸDOM</td>
<td>æœ€å°ç»ˆç«¯æ›´æ–°</td>
</tr>
</tbody></table>
<h3 id="Startup-Time-Optimization"><a href="#Startup-Time-Optimization" class="headerlink" title="Startup Time Optimization"></a>Startup Time Optimization</h3><h3 id="å¯åŠ¨æ—¶é—´ä¼˜åŒ–"><a href="#å¯åŠ¨æ—¶é—´ä¼˜åŒ–" class="headerlink" title="å¯åŠ¨æ—¶é—´ä¼˜åŒ–"></a>å¯åŠ¨æ—¶é—´ä¼˜åŒ–</h3><p>Dependencies are structured for lazy loading:<br>ä¾èµ–é¡¹ç»“æ„åŒ–ç”¨äºå»¶è¿ŸåŠ è½½ï¼š</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// Inferred lazy loading pattern</span>
<span class="token comment">// æ¨æ–­çš„å»¶è¿ŸåŠ è½½æ¨¡å¼</span>
<span class="token keyword">const</span> <span class="token constant">LAZY_DEPS</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token string-property property">'sharp'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sharp'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string-property property">'@aws-sdk/client-bedrock-runtime'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@aws-sdk/client-bedrock-runtime'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string-property property">'google-auth-library'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'google-auth-library'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getLazyDep</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">LAZY_DEPS</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>_cached<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token constant">LAZY_DEPS</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>_cached <span class="token operator">=</span> <span class="token constant">LAZY_DEPS</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token constant">LAZY_DEPS</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>_cached<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<p><em>This dependency analysis is based on decompilation and reverse engineering. Actual implementation details may vary. The patterns and insights presented represent inferred architectural decisions based on observable behavior and common practices in the Node.js ecosystem.</em><br><em>æ­¤ä¾èµ–é¡¹åˆ†æåŸºäºåç¼–è¯‘å’Œé€†å‘å·¥ç¨‹ã€‚å®é™…å®ç°ç»†èŠ‚å¯èƒ½æœ‰æ‰€ä¸åŒã€‚æ‰€å‘ˆç°çš„æ¨¡å¼å’Œæ´å¯Ÿä»£è¡¨äº†åŸºäºå¯è§‚å¯Ÿè¡Œä¸ºå’ŒNode.jsç”Ÿæ€ç³»ç»Ÿä¸­å¸¸è§å®è·µæ¨æ–­çš„æ¶æ„å†³ç­–ã€‚</em></p>
<h1 id="æ–‡ä»¶æ€»ç»“"><a href="#æ–‡ä»¶æ€»ç»“" class="headerlink" title="æ–‡ä»¶æ€»ç»“"></a>æ–‡ä»¶æ€»ç»“</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æœ¬æ–‡æ¡£æ·±å…¥åˆ†æäº†Claude Codeçš„ä¾èµ–æ¶æ„ï¼Œæ­ç¤ºäº†å…¶é«˜æ€§èƒ½å’Œå¯é æ€§èƒŒåçš„æŠ€æœ¯å†³ç­–ã€‚é€šè¿‡åç¼–è¯‘å’Œé€†å‘å·¥ç¨‹åˆ†æï¼Œæ–‡æ¡£å±•ç°äº†Claude Codeå¦‚ä½•é€šè¿‡ç²¾å¿ƒé€‰æ‹©çš„ä¾èµ–é¡¹æ¥å®ç°å…¶å“è¶Šçš„åŠŸèƒ½ã€‚</p>
<h2 id="æ ¸å¿ƒæ¶æ„ç‰¹ç‚¹"><a href="#æ ¸å¿ƒæ¶æ„ç‰¹ç‚¹" class="headerlink" title="æ ¸å¿ƒæ¶æ„ç‰¹ç‚¹"></a>æ ¸å¿ƒæ¶æ„ç‰¹ç‚¹</h2><h3 id="1-ç»ˆç«¯Reactæ¶æ„"><a href="#1-ç»ˆç«¯Reactæ¶æ„" class="headerlink" title="1. ç»ˆç«¯Reactæ¶æ„"></a>1. ç»ˆç«¯Reactæ¶æ„</h3><ul>
<li><strong>æŠ€æœ¯æ ˆ</strong>ï¼šReact 18.2.0 + Ink 3.2.0 + Yoga Layout WebAssembly</li>
<li><strong>åˆ›æ–°ç‚¹</strong>ï¼šå°†Reactçš„è™šæ‹ŸDOMå’Œåè°ƒç®—æ³•å¼•å…¥ç»ˆç«¯ç¯å¢ƒ</li>
<li><strong>ä¼˜åŠ¿</strong>ï¼š<ul>
<li>å£°æ˜å¼UIçŠ¶æ€ç®¡ç†</li>
<li>äºšæ¯«ç§’çº§å¸ƒå±€è®¡ç®—</li>
<li>é«˜æ•ˆçš„ç»ˆç«¯å­—ç¬¦ä½ç½®ä¼˜åŒ–</li>
<li>æ”¯æŒå¤æ‚UIçŠ¶æ€ï¼ˆæƒé™å¯¹è¯æ¡†ã€è¿›åº¦æŒ‡ç¤ºå™¨ã€å¹¶å‘å·¥å…·æ‰§è¡Œï¼‰</li>
</ul>
</li>
</ul>
<h3 id="2-æµå¼è§£æå™¨æ¶æ„"><a href="#2-æµå¼è§£æå™¨æ¶æ„" class="headerlink" title="2. æµå¼è§£æå™¨æ¶æ„"></a>2. æµå¼è§£æå™¨æ¶æ„</h3><ul>
<li><strong>è‡ªå®šä¹‰è§£æå™¨</strong>ï¼š<ul>
<li>Shellè§£æå™¨ï¼šæ”¯æŒJSONå¯¹è±¡åµŒå…¥å’Œé€’å½’å‘½ä»¤æ›¿æ¢</li>
<li>XMLè§£æå™¨ï¼šé’ˆå¯¹LLMå“åº”ä¼˜åŒ–çš„æµå¼è§£æ</li>
</ul>
</li>
<li><strong>æ ¸å¿ƒåˆ›æ–°</strong>ï¼šé€šè¿‡å“¨å…µå­—ç¬¦ä¸²æœºåˆ¶å®ç°å¤æ‚é…ç½®å¯¹è±¡çš„shellå‘½ä»¤ä¼ é€’</li>
</ul>
<h3 id="3-å¤šå¹³å°LLMæŠ½è±¡å±‚"><a href="#3-å¤šå¹³å°LLMæŠ½è±¡å±‚" class="headerlink" title="3. å¤šå¹³å°LLMæŠ½è±¡å±‚"></a>3. å¤šå¹³å°LLMæŠ½è±¡å±‚</h3><ul>
<li><strong>æ”¯æŒçš„æä¾›å•†</strong>ï¼šAnthropicã€AWS Bedrockã€Google Vertex AI</li>
<li><strong>è®¾è®¡æ¨¡å¼</strong>ï¼šå·¥å‚æ¨¡å¼ + é€‚é…å™¨æ¨¡å¼</li>
<li><strong>ç‰¹æ€§</strong>ï¼š<ul>
<li>å…¨SSEæµå¼æ”¯æŒ</li>
<li>è·¨åŒºåŸŸæ•…éšœè½¬ç§»</li>
<li>è‡ªåŠ¨ä»¤ç‰Œåˆ·æ–°</li>
<li>SigV4è®¤è¯</li>
</ul>
</li>
</ul>
<h3 id="4-é¥æµ‹ä¸‰é‡æ ˆ"><a href="#4-é¥æµ‹ä¸‰é‡æ ˆ" class="headerlink" title="4. é¥æµ‹ä¸‰é‡æ ˆ"></a>4. é¥æµ‹ä¸‰é‡æ ˆ</h3><ul>
<li><strong>é”™è¯¯è¿½è¸ª</strong>ï¼šSentryï¼ˆANRæ£€æµ‹ã€é”™è¯¯è¾¹ç•Œã€æ€§èƒ½åˆ†æï¼‰</li>
<li><strong>æŒ‡æ ‡ç›‘æ§</strong>ï¼šOpenTelemetryï¼ˆè‡ªå®šä¹‰spanã€ä»¤ç‰Œè®¡æ•°å™¨ã€å»¶è¿Ÿç›´æ–¹å›¾ï¼‰</li>
<li><strong>åŠŸèƒ½æ ‡å¿—</strong>ï¼šStatsigï¼ˆA/Bæµ‹è¯•ã€æ¸è¿›å¼æ¨å‡ºã€åŠ¨æ€é…ç½®ï¼‰</li>
</ul>
<h2 id="æŠ€æœ¯äº®ç‚¹"><a href="#æŠ€æœ¯äº®ç‚¹" class="headerlink" title="æŠ€æœ¯äº®ç‚¹"></a>æŠ€æœ¯äº®ç‚¹</h2><h3 id="æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"><a href="#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"></a>æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h3><ol>
<li><p><strong>å†…å­˜ç®¡ç†</strong>ï¼š</p>
<ul>
<li>æµå¼æ–‡ä»¶è¯»å–</li>
<li>å›¾åƒå¤„ç†ä½¿ç”¨åŸç”Ÿlibvipsï¼ˆå †å¤–å†…å­˜ï¼‰</li>
<li>SAXé£æ ¼XMLè§£æï¼ˆå¸¸é‡å†…å­˜ï¼‰</li>
<li>é¢„ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼</li>
</ul>
</li>
<li><p><strong>å¯åŠ¨æ—¶é—´ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>å»¶è¿ŸåŠ è½½ä¾èµ–é¡¹</li>
<li>ç¼“å­˜æœºåˆ¶</li>
<li>æŒ‰éœ€åˆå§‹åŒ–</li>
</ul>
</li>
</ol>
<h3 id="å®‰å…¨è€ƒè™‘"><a href="#å®‰å…¨è€ƒè™‘" class="headerlink" title="å®‰å…¨è€ƒè™‘"></a>å®‰å…¨è€ƒè™‘</h3><ol>
<li><strong>è¾“å…¥éªŒè¯å±‚</strong>ï¼šZod schemaéªŒè¯</li>
<li><strong>æ²™ç›’åŒ–ä¾èµ–</strong>ï¼šé¿å…ç›´æ¥ä½¿ç”¨child_processå’Œeval</li>
<li><strong>ç§˜å¯†ç®¡ç†</strong>ï¼šå¹³å°ç‰¹å®šçš„å¯†é’¥å­˜å‚¨ï¼ˆmacOSé’¥åŒ™ä¸²ã€ç¯å¢ƒå˜é‡ï¼‰</li>
</ol>
<h3 id="æ•°æ®å¤„ç†ç®¡é“"><a href="#æ•°æ®å¤„ç†ç®¡é“" class="headerlink" title="æ•°æ®å¤„ç†ç®¡é“"></a>æ•°æ®å¤„ç†ç®¡é“</h3><ul>
<li><strong>è¾“å…¥æº</strong>ï¼šç”¨æˆ·æ–‡æœ¬ã€Webå†…å®¹ã€å›¾åƒã€JSONæ•°æ®</li>
<li><strong>è½¬æ¢å±‚</strong>ï¼šZodéªŒè¯ã€Markdownè§£æã€HTMLâ†’MDè½¬æ¢ã€å›¾åƒå¤„ç†</li>
<li><strong>è¾“å‡º</strong>ï¼šç±»å‹å®‰å…¨æ•°æ®ã€Markdown ASTã€ä¼˜åŒ–å›¾åƒ</li>
</ul>
<h2 id="ä¸“ä¸šåŒ–ä¾èµ–é¡¹"><a href="#ä¸“ä¸šåŒ–ä¾èµ–é¡¹" class="headerlink" title="ä¸“ä¸šåŒ–ä¾èµ–é¡¹"></a>ä¸“ä¸šåŒ–ä¾èµ–é¡¹</h2><h3 id="éšè—çš„å®çŸ³"><a href="#éšè—çš„å®çŸ³" class="headerlink" title="éšè—çš„å®çŸ³"></a>éšè—çš„å®çŸ³</h3><ol>
<li><strong>fast-xml-parser</strong>ï¼šé’ˆå¯¹LLMé€šä¿¡å®šåˆ¶</li>
<li><strong>plistè§£æå™¨</strong>ï¼šmacOSç‰¹å®šä¼˜åŒ–</li>
<li><strong>cross-spawn</strong>ï¼šè·¨å¹³å°è¿›ç¨‹ç”Ÿæˆ</li>
</ol>
<h3 id="æ–‡ä»¶ç³»ç»Ÿæ™ºèƒ½"><a href="#æ–‡ä»¶ç³»ç»Ÿæ™ºèƒ½" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿæ™ºèƒ½"></a>æ–‡ä»¶ç³»ç»Ÿæ™ºèƒ½</h3><ul>
<li><strong>æ¨¡å¼åŒ¹é…</strong>ï¼šglob + picomatch + minimatch</li>
<li><strong>è¿‡æ»¤ç®¡é“</strong>ï¼šå¿½ç•¥è§„åˆ™ + è‡ªå®šä¹‰è§„åˆ™</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šLRUç¼“å­˜æ¨¡å¼åŒ¹é…å™¨</li>
</ul>
<h2 id="æ¶æ„æ´å¯Ÿ"><a href="#æ¶æ„æ´å¯Ÿ" class="headerlink" title="æ¶æ„æ´å¯Ÿ"></a>æ¶æ„æ´å¯Ÿ</h2><h3 id="è®¾è®¡åŸåˆ™"><a href="#è®¾è®¡åŸåˆ™" class="headerlink" title="è®¾è®¡åŸåˆ™"></a>è®¾è®¡åŸåˆ™</h3><ol>
<li><strong>æ€§èƒ½ä¼˜å…ˆ</strong>ï¼šWebAssemblyå¸ƒå±€å¼•æ“ã€åŸç”Ÿå›¾åƒå¤„ç†</li>
<li><strong>è·¨å¹³å°å…¼å®¹</strong>ï¼šç»Ÿä¸€çš„æŠ½è±¡å±‚å¤„ç†å¹³å°å·®å¼‚</li>
<li><strong>å¯è§‚æµ‹æ€§</strong>ï¼šä¸‰é‡ç›‘æ§æ ˆç¡®ä¿ç”Ÿäº§ç¯å¢ƒç¨³å®šæ€§</li>
<li><strong>å®‰å…¨æ€§</strong>ï¼šå¤šå±‚éªŒè¯å’Œæ²™ç›’åŒ–æœºåˆ¶</li>
</ol>
<h3 id="å®ç°æ¨¡å¼"><a href="#å®ç°æ¨¡å¼" class="headerlink" title="å®ç°æ¨¡å¼"></a>å®ç°æ¨¡å¼</h3><ol>
<li><strong>å·¥å‚æ¨¡å¼</strong>ï¼šLLMå®¢æˆ·ç«¯åˆ›å»º</li>
<li><strong>é€‚é…å™¨æ¨¡å¼</strong>ï¼šå¤šæä¾›å•†APIç»Ÿä¸€</li>
<li><strong>ç­–ç•¥æ¨¡å¼</strong>ï¼šä¸åŒå¹³å°çš„åŠŸèƒ½å®ç°</li>
<li><strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>ï¼šé¥æµ‹å’Œç›‘æ§</li>
</ol>
<h2 id="æŠ€æœ¯ä»·å€¼"><a href="#æŠ€æœ¯ä»·å€¼" class="headerlink" title="æŠ€æœ¯ä»·å€¼"></a>æŠ€æœ¯ä»·å€¼</h2><h3 id="åˆ›æ–°ç‚¹"><a href="#åˆ›æ–°ç‚¹" class="headerlink" title="åˆ›æ–°ç‚¹"></a>åˆ›æ–°ç‚¹</h3><ol>
<li><strong>ç»ˆç«¯Reactåº”ç”¨</strong>ï¼šå°†ç°ä»£WebæŠ€æœ¯å¼•å…¥CLIç¯å¢ƒ</li>
<li><strong>æµå¼è§£æ</strong>ï¼šå¤„ç†å¤æ‚çš„LLMå“åº”æ ¼å¼</li>
<li><strong>å¤šäº‘æŠ½è±¡</strong>ï¼šç»Ÿä¸€çš„LLMè®¿é—®æ¥å£</li>
<li><strong>ANRæ£€æµ‹</strong>ï¼šNode.jsç¯å¢ƒçš„åº”ç”¨æ— å“åº”æ£€æµ‹</li>
</ol>
<h3 id="å·¥ç¨‹å®è·µ"><a href="#å·¥ç¨‹å®è·µ" class="headerlink" title="å·¥ç¨‹å®è·µ"></a>å·¥ç¨‹å®è·µ</h3><ol>
<li><strong>ä¾èµ–é¡¹é€‰æ‹©</strong>ï¼šæ¯ä¸ªä¾èµ–éƒ½æœ‰æ˜ç¡®çš„æŠ€æœ¯ç›®çš„</li>
<li><strong>å†…å­˜ç®¡ç†</strong>ï¼šç²¾å¿ƒè®¾è®¡çš„å†…å­˜ä½¿ç”¨ç­–ç•¥</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šå…¨é¢çš„é”™è¯¯è¿½è¸ªå’ŒæŠ¥å‘Šæœºåˆ¶</li>
<li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼šè¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡å’Œåˆ†æ</li>
</ol>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>Claude Codeçš„æ¶æ„ä½“ç°äº†ç°ä»£è½¯ä»¶å·¥ç¨‹çš„æœ€ä½³å®è·µï¼Œé€šè¿‡ç²¾å¿ƒé€‰æ‹©çš„ä¾èµ–é¡¹å’Œåˆ›æ–°çš„è®¾è®¡æ¨¡å¼ï¼Œå®ç°äº†é«˜æ€§èƒ½ã€é«˜å¯é æ€§çš„CLIå·¥å…·ã€‚å…¶æ¶æ„ä¸ä»…è§£å†³äº†ä¼ ç»ŸCLIå·¥å…·çš„å±€é™æ€§ï¼Œè¿˜ä¸ºå¼€å‘è€…æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<p>è¿™ç§æ¶æ„è®¾è®¡çš„æˆåŠŸåœ¨äºï¼š</p>
<ul>
<li><strong>æŠ€æœ¯åˆ›æ–°</strong>ï¼šå°†Reactç”Ÿæ€å¼•å…¥ç»ˆç«¯ç¯å¢ƒ</li>
<li><strong>å·¥ç¨‹å“è¶Š</strong>ï¼šå…¨é¢çš„ç›‘æ§ã€å®‰å…¨å’Œæ€§èƒ½ä¼˜åŒ–</li>
<li><strong>å®ç”¨ä¸»ä¹‰</strong>ï¼šæ¯ä¸ªæŠ€æœ¯é€‰æ‹©éƒ½æœ‰æ˜ç¡®çš„ä¸šåŠ¡ä»·å€¼</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šæ¨¡å—åŒ–è®¾è®¡æ”¯æŒæœªæ¥åŠŸèƒ½æ‰©å±•</li>
</ul>
<p>æœ¬æ–‡æ¡£çš„åˆ†æä¸ºç†è§£ç°ä»£CLIå·¥å…·çš„è®¾è®¡å’Œå®ç°æä¾›äº†å®è´µçš„å‚è€ƒï¼Œç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦åœ¨ç»ˆç«¯ç¯å¢ƒä¸­æä¾›å¤æ‚äº¤äº’åŠŸèƒ½çš„åº”ç”¨ç¨‹åºã€‚</p>

                
            </div>
            <hr/>

            



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">æ— æ ‡ç­¾</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">èµ</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">ä½ çš„èµè¯†æ˜¯æˆ‘å‰è¿›çš„åŠ¨åŠ›</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">æ”¯ä»˜å®</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">å¾® ä¿¡</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;ä¸Šä¸€ç¯‡</div>
            <div class="card">
                <a href="/2025/10/23/claude-code-shu-ju-jie-gou-yu-xiao-xi-jia-gou/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/21.jpg" class="responsive-img" alt="claude-codeæ•°æ®ç»“æ„ä¸æ¶ˆæ¯æ¶æ„">
                        
                        <span class="card-title">claude-codeæ•°æ®ç»“æ„ä¸æ¶ˆæ¯æ¶æ„</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-10-23
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            å¯’éœœ
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ä¸‹ä¸€ç¯‡&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2025/10/22/bian-ji-qi-cha-jian-he-ji/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="ç¼–è¾‘å™¨æ’ä»¶åˆé›†">
                        
                        <span class="card-title">ç¼–è¾‘å™¨æ’ä»¶åˆé›†</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-10-22
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            å¯’éœœ
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- ä»£ç å—åŠŸèƒ½ä¾èµ– -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- æ˜¯å¦åŠ è½½ä½¿ç”¨è‡ªå¸¦çš„ prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- ä»£ç è¯­è¨€ -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- ä»£ç å—å¤åˆ¶ -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- ä»£ç å—æ”¶ç¼© -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC æ‚¬æµ®æŒ‰é’®. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('6'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* ä¿®å¤æ–‡ç« å¡ç‰‡ div çš„å®½åº¦. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // åˆ‡æ¢TOCç›®å½•å±•å¼€æ”¶ç¼©çš„ç›¸å…³æ“ä½œ.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            <!-- Copyright&nbsp;&copy;
            
                <span id="year">2019-2025</span>
             -->
            <!-- <a href="/about" target="_blank">å¯’éœœ</a> -->
            <!-- |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
             -->
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;ç«™ç‚¹æ€»å­—æ•°:&nbsp;<span
                        class="white-color">161.7k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;æ€»è®¿é—®é‡:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;æ€»è®¿é—®äººæ•°:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- è¿è¡Œå¤©æ•°æé†’. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="é‚®ä»¶è”ç³»æˆ‘" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQè”ç³»æˆ‘: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS è®¢é˜…" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- æœç´¢é®ç½©æ¡† -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;æœç´¢</span>
            <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- ç™½å¤©å’Œé»‘å¤œä¸»é¢˜ -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- é›ªèŠ±ç‰¹æ•ˆ -->
    

    <!-- é¼ æ ‡æ˜Ÿæ˜Ÿç‰¹æ•ˆ -->
    

    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--è…¾è®¯å…”å°å·¢-->
    
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
